# SDK Update: Remove Policy Version Flag

## 🎯 **Change Required**

The D2 Cloud backend now handles **automatic policy versioning**. Please remove the version flag/parameter from the SDK policy upload commands.

## 📋 **What Changed**

### **Before (OLD - Remove This):**
```bash
# SDK command with manual version flag
d2 policy upload --version 3 policy.yaml
```
```json
// API payload (OLD)
{
  "version": 3,
  "bundle": { ... }
}
```

### **After (NEW - Implement This):**
```bash
# SDK command without version flag  
d2 policy upload policy.yaml
```
```json
// API payload (NEW)
{
  "bundle": { ... }
  // version is auto-generated by backend
}
```

## 🔧 **Backend Behavior**

The backend now:
- ✅ **Auto-generates** the next version number
- ✅ **Maintains only one draft** per account
- ✅ **Handles version conflicts** automatically
- ✅ **Increments from highest** existing version (draft or published)

## 📊 **Version Logic Examples**

| Current State | Upload Draft → | New Draft Version |
|---------------|----------------|-------------------|
| No policies | Upload | v1 |
| Published v2 | Upload | v3 |
| Published v2, Draft v4 | Upload | v5 (replaces v4 draft) |
| Draft v3 only | Upload | v4 (replaces v3 draft) |

## 🚀 **SDK Changes Needed**

1. **Remove** `--version` flag from CLI commands
2. **Remove** `version` field from API request payloads  
3. **Update** documentation to reflect automatic versioning
4. **Update** error handling (no more version conflict errors)

## 📚 **Updated API Contract**

### **Draft Upload**
```http
PUT /v1/policy/draft
Content-Type: application/json

{
  "bundle": {
    "metadata": { ... },
    "policies": [ ... ]
  }
}
```

### **Response** 
```json
{
  "message": "Draft uploaded"
}
```

## ⚠️ **Breaking Change Notice**

This is a **breaking change** for SDK users. Please:
- 🔄 **Update SDK version** with this change
- 📢 **Notify users** about removing version flags
- 📖 **Update documentation** and examples
- 🧪 **Test** with automatic versioning

## 🤝 **Questions?**

Contact the backend team if you need clarification on the new versioning behavior or API contract changes.

---
**Timeline:** Please implement this change in the next SDK release to maintain compatibility with the updated backend.

